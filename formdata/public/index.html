<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ngMessages Demo</title> 
    
    <!-- JS -->
    <script src="http://code.angularjs.org/1.4.0/angular.js"></script> 
</head>
<body class="container" ng-app="app" ng-controller="main">
    
    <form method="post" enctype="multipart/form-data">
        <input type="text" name="t" ng-model="d.t" /><br /><br />
        <input type="text" name="d" ng-model="d.d" /><br /><br />
        <input type="file" name="file" file-model="d.image" /><br /><br /> 
        <button ng-click="post()">Post</button>
    </form>
    {{d}}
 
     <script>
 var app= angular.module('app', []);
 /*=========diretive==========*/
 app.directive('fileModel', ['$parse', function ($parse) {
        return {
           restrict: 'A',
           link: function(scope, element, attrs) {
              var model = $parse(attrs.fileModel);
              var modelSetter = model.assign; 
              element.bind('change', function(){
                 scope.$apply(function(){
                    modelSetter(scope, element[0].files[0]);

                 });
              });
           }
        };
     }]);

 /*======service=========*/
 app.service('fileUpload', ['$http',function ($http) {
        this.uploadFileToUrl = function( data, uploadUrl){  
           var fd=new FormData();   
            for(key in data){
              fd.append(key, data[key]);
              console.log(fd);
            } 
           $http.post(uploadUrl,fd,{
            transformRequest: angular.identity,
            headers: {'Content-Type': undefined} }) 
           .success(function(res){
            console.log(res.length);
            })
           .error(function(){
           });
        }
     }]);
 /*=====controller to send data===*/
 app.controller("main",function($scope, fileUpload){
    $scope.post=function(){ 
        var data=$scope.d;   
        var uploadUrl="/upload";
        fileUpload.uploadFileToUrl(data, uploadUrl);  
    } 
 });
    

</script>
</body>
</html>